{% extends 'base.html' %}

{% block content %}
    <div id="profile">
        <a class="home" href="{{ url_for('home') }}">&#8592 Home</a>
        <h1 class="title">{% block title %} Profile {% endblock %}</h1>
        <h2> Welcome <span id="userName"></span> ðŸ‘‹</h2>
        <p class="email" id="userEmail"></p>
        <button id="get_data_btn" class="link logout" onclick="logout()">Logout</button>
    </div>

    <script src="{{url_for('static', filename='descope.js')}}"></script>
    <script>
        const userName = document.getElementById('userName')
        const userEmail = document.getElementById('userEmail')
        const profileContainer = document.getElementById('profile')

        function getProfileData(){
            fetch('/get_profile', { // call the api endpoint from the flask server
                headers: {
                    Accept: 'application/json',
                    Authorization: 'Bearer ' + sessionToken,
                }
            }).then(data => {
                if (data.status === 401) { // error
                    window.location.href = '/login'
                }
                return data.json()
            }).then(jsonData => {
                console.log(jsonData)
                return jsonData
            }).catch((err) => {
                console.log(err) // error
                window.location.href = '/login'
            })
        }

        profileContainer.addEventListener('load', function() {
            const data = getProfileData();
            console.log(data)
        });

        if (sessionToken) {

        } else if (validRefreshToken && !sessionToken) {
            sdk.refresh()
        } else {
            window.location.href = "/login"
        }

        async function logout() {
            await sdk.logout()
            window.location.href = "/login"
        }
    </script>
{% endblock %}


