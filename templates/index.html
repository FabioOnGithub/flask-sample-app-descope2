{% extends 'base.html' %}

{% block content %}
  <h1 class="title">{% block title %} Home {% endblock %}</h1>

  <h1>Descope-Flask Demo</h1>
  <div id="container"></div>
  <script src="{{url_for('static', filename='descope.js')}}"></script>
  
  <script>
    const container = document.getElementById('container');
    
    // console.log(sdk.isJwtExpired(sessionToken))

    if (!sessionToken || notValidToken) {
        container.innerHTML = '<descope-wc project-id="' + projectId + '" flow-id="sign-up-or-in"></descope-wc>';
        const wcElement = document.getElementsByTagName('descope-wc')[0];

        const onSuccess = (e) => {
            sdk.refresh() 
            fetch("/login", {
                method: "post",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    session_token: e.detail.sessionJwt,
                    user: e.detail.user.loginIds,
                })
            })
            .then((response) => { 
                console.log(response)
                window.location.href = "/login"
            });
        }

        const onError = (err) => console.log(err);

        wcElement.addEventListener('success', onSuccess);
        wcElement.addEventListener('error', onError);
    }
  </script>
{% endblock %}
